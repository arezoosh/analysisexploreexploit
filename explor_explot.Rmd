---
title: "explore_exploit"
author: "arezoo"
date: "12/8/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r paged.print=TRUE}

library(tidyverse)

#save(team_id_risk,file="file_id_risk.RData")
load("~/file_id_risk.RData")
 load("~/bandit.RData")
 load("~/visual.RData")
 team_id_risk<-slice(team_id_risk,-38)
 getmode <- function(v) {
   uniqv <- unique(v)
   uniqv[which.max(tabulate(match(v, uniqv)))]
}

```
```{r}
choice_bandit<- array(NA,dim = c(length(bandit_txt_data),200))
payoff_bandit <- array(NA,dim = c(length(bandit_txt_data),200))
period_bandit<- array(NA,dim = c(length(bandit_txt_data),20))
id_bandit<- array(NA,dim =length(bandit_txt_data))
for (i in 1:length(bandit_txt_data)){
 choice_bandit[i,]<- bandit_txt_data[[i]][["V1"]]
 payoff_bandit[i,]<- bandit_txt_data[[i]][["V2"]]
 #period_bandit[i,]<-bandit_txt_data[[i]][['period']]
 id_bandit[i]<-bandit_txt_data[[i]][["id"]][1]
}

###### 
##find cutpoints for each period and each person bandit

a1<-seq(1, 200, 10)
a2<-seq(10,200,10)
newseq<- array(NA,dim = c(20,10))
choice<-array(NA,dim = c(length(bandit_txt_data),20,10))
payoff<-array(NA,dim = c(length(bandit_txt_data),20,10))
bandit_cutpoint<-array(NA,dim = c(length(bandit_txt_data),20,10))
bandit_choice<-array(NA,dim = c(length(bandit_txt_data),20,10))
median_cut_bandit<-array(NA,dim = c(length(bandit_txt_data),20))
mean_choice_bandit<-array(NA,dim = c(length(bandit_txt_data),20))
bandit_expr_new<-array(NA,dim = 
c(length(bandit_txt_data),20))
mode_choice_bandit<-array(NA,dim = c(length(bandit_txt_data),20))
first_3<-array(NA,dim = c(length(bandit_txt_data),20))

for (i in 1:20){
newseq[i,]<-(a1[i]:a2[i])
}
  for (i in 1:length(bandit_txt_data)){
    for(j in 1:20){
     choice[i,j,]<-choice_bandit[i,newseq[j,]]
     payoff[i,j,]<-payoff_bandit[i,newseq[j,]] 
     first_3[i,j]<-mean(choice_bandit[i,newseq[j]:(newseq[j]+2)])
    }
  }

  for (i in 1:length(bandit_txt_data)){
    for(j in 1:20){
      c<-0
      for(k in 1:10){
        if (payoff[i,j,k] == 1690){
          c<-c+1
          bandit_cutpoint[i,j,k]<-c
          bandit_choice[i,j,k]<-1
        }
        if (payoff[i,j,k] == 0){
          c<-c-1
          bandit_cutpoint[i,j,k]<-c
          bandit_choice[i,j,k]<-1
        }
         if (payoff[i,j,k] == 845){
          bandit_cutpoint[i,j,k]<-c
          bandit_choice[i,j,k]<-0
        }
      }
      median_cut_bandit[i,j]<-median(bandit_cutpoint[i,j,])
      mean_choice_bandit[i,j]<-mean(bandit_choice[i,j,],na.rm=TRUE)
     bandit_expr_new[i,j]<-sum(bandit_choice[i,j,],na.rm=TRUE)
     mode_choice_bandit[i,j]<-getmode(bandit_choice[i,j,])
    }
  }
```


```{r}
# find all fixations for visual task
library(tidyr)
report_address <-("~/Documents/newreport/newreport_*.txt")
 report_file_address <- Sys.glob(report_address)
report_data <- array(NA,dim = length(report_file_address))
report_name1<-array(NA,dim = length(report_file_address))

 for (i in 1:length(report_file_address)){
    report_data[i]<- list(read.delim(report_file_address[i],header=FALSE))
#names(report_data[[i]])<-c('endfixation','','','','duration','','','','','option')
report_name1[i] <- gsub("/Users/au608780/Documents/newreport/newreport_",replacement = '',report_file_address[i])
 }
report_name <- substr(report_name1, 0, 4)

fixation_report <- list(NA)
fixed_options <- list(NA)
all_report <- list(NA)
explre_new<- list(NA)
for (i in 1:length(report_file_address)){
  a<-which(report_data[[i]]$V2!='R'&  report_data[[i]]$V2!='')
  a<-c(1,a)
  look <- array(NA, dim = (length(a)-1))
  explor_new<- array(NA, dim = (length(a)-1))
  for (j in 1:(length(a)-1)){
  tmp_look <- report_data[[i]]$V10[a[j]:a[j+1]]
  
  tmp_look2<-extract_numeric(substr(tmp_look,0,4))
  tmp_look3<-na.omit(tmp_look2)
  look[j]<-list(tmp_look3)
  explor_new[j]<-sum(look[[j]][!duplicated(look[[j]])]!=0)
  }
  explre_new[i]<-list(explor_new)
  fixed_options[i]<-list(look)
  all_report[[i]]<-list(bandit_txt_data[[i]], fixed_options[[i]],report_name[i],team_id_risk$id[i],team_id_risk$group[i],team_id_risk$risk[i],explre_new[i])
  }
```


```{r}
group1_visual_data <- readxl::read_excel("/Users/au608780/Documents/group1_visual_data.xls")
fixed1_visual <- readxl::read_excel("/Users/au608780/Documents/fixed1_visual.xls")
group2_visual_data <- readxl::read_excel("/Users/au608780/Documents/group2_visual_data.xls")
fixed2_visual <- readxl::read_excel("/Users/au608780/Documents/fixed2_visual.xls")
option_looked <- array(NA,dim = length(visual_txt_data))
option_cut<- array(NA,dim = length(visual_txt_data))
mode_option_looked<- array(NA,dim = c(length(visual_txt_data),20))
mean_look_visual <- array(NA,dim = c(length(visual_txt_data),20))

for (i in 1:length(all_report)){
        looked <- array(NA,dim = 20)
        looked_bin<-array(NA,dim = 20)
        cut_looked <- array(NA,dim = 20)
        if (all_report[[i]][[5]]=='1'){
          gr<-group1_visual_data
          fx<-fixed1_visual
        } else {
          gr<-group2_visual_data
          fx<-fixed2_visual
        }
      for (j in 1:20){
        tmp<-all_report[[i]][[2]][[j]]
        if (length(tmp)!=0){
        tmplooked<- array(NA,dim =length(tmp))
        cutpoint<- array(NA,dim =length(tmp))
        for (k in 1:length(tmp)){
          if (tmp[k]==0){
            tmplooked[k]<-as.numeric(fx[j])
            cutpoint[k]<- 0
            looked_bin[k]<-0
          } else {
            looked_bin[k]<-1
            tmplooked[k]<-as.numeric(gr[j,tmp[k]])
            if (tmplooked[k] > 16000){
              cutpoint[k]<- 1
            } else {
              cutpoint[k]<- -1
            }
              
          }
        }
        looked[j] <-list(tmplooked)
        cut_looked[j]<-list(cutpoint)
        tmp_bin<-getmode(looked_bin)
        tmp_explr<-mean(looked_bin,na.rm=TRUE)
        }
        mode_option_looked[i,j]<-tmp_bin
        mean_look_visual[i,j]<-tmp_explr
}   


  option_cut[i]<-list(cut_looked)  
  option_looked[i]<-list(looked)
}
final_report<-list(cutpoint,option_cut,option_looked,report_name,team_id_risk$id,team_id_risk$group,team_id_risk$risk)
```




```{r}
#visual and bandit cutpoints
bandit_switching_point<-array(NA,dim =c( length(bandit_txt_data),20,10))
tmpcut2<-array(NA,dim = length(bandit_txt_data))
option_chose_bandit<- array(NA,dim = length(bandit_txt_data))
for (i in 1:length(bandit_txt_data)){
  option_chose_bandit[i]<-list(bandit_txt_data[[i]][["V2"]])
  tmpcut1<-array(NA,dim = 20)
  for(j in 1:20){
    c<-0
    tmpcut<-array(NA, dim = 10)
    for(k in 1:10){
      if (payoff[i,j,k] == 1690){
        c<-c+1
        bandit_switching_point[i,j,k]<-0

      }
      if (payoff[i,j,k] == 0){
        c<-c-1
        bandit_switching_point[i,j,k]<-0
        
      }
      if (payoff[i,j,k] == 845){
        c<-c
        bandit_switching_point[i,j,k]<-k
      }
      tmpcut[k]<-c
    }
    tmpcut1[j]<-list(tmpcut)
  }
  tmpcut2[i]<-list(tmpcut1)
}
bandit_cutpoints<-tmpcut2
#visual_cutpoint <- list(NA,dim = c(length(visual_data),20))
tmpcut2<-array(NA,dim = length(option_looked))
for (i in 1:length(option_looked)){
  tmpcut1<-array(NA,dim = 20)
  for(j in 1:20){
    c<-0
    tmpcut<-array(NA, dim = length(option_looked[[i]][[j]]))
    for (k in 1:length(option_looked[[i]][[j]])){
      if (!is.na(option_looked[[i]][[j]][k])){
    if (option_looked[[i]][[j]][k] > 16600){
      c<-c+1
      
    }
    if (option_looked[[i]][[j]][k] < 1300){
      c<-c-1
      
    }
    
    if (option_looked[[i]][[j]][k] > 1350 & option_looked[[i]][[j]][k] < 1650){
      c<-c
    }
      tmpcut[k]<-c
    }
    }
    tmpcut1[j]<-list(tmpcut)
  }
  tmpcut2[i]<-list(tmpcut1)
}
visual_cutpoints<-tmpcut2
visual_min_cut<- array(NA,dim = c(length(visual_cutpoints),20))
bandit_min_cut<- array(NA,dim = c(length(bandit_cutpoints),20))
cor_both<- array(NA,dim = c(length(bandit_cutpoints),2))
z_cut_visual<-array(NA,dim = c(length(visual_cutpoints),20))
z_cut_bandit<-array(NA,dim = c(length(bandit_cutpoints),20))
for ( i in 1:length(visual_cutpoints)){
  for (j in 1:20){
    visual_min_cut[i,j]<-min(visual_cutpoints[[i]][[j]])
    bandit_min_cut[i,j]<-min(bandit_cutpoints[[i]][[j]])
 
  }
  visual_min_cut[i,][is.na(visual_min_cut[i,])]<-0
  bandit_min_cut[i,][is.na(bandit_min_cut[i,])]<-0
  z_cut_visual[i,]<-round(((visual_min_cut[i,]-mean(visual_min_cut[i,]))/sd(visual_min_cut[i,])),digits= 2)
  z_cut_bandit[i,]<-round(((bandit_min_cut[i,]-mean(bandit_min_cut[i,]))/sd(bandit_min_cut[i,])),digits= 2)
  aa<-cor.test(z_cut_visual[i,],z_cut_bandit[i,])
  cor_both[i,1]<-aa$statistic
  cor_both[i,2]<-aa$p.value
}

#questionaire part
```

```{r}

#switching point in bandit to arm A
switch_final<- NA
bandit_switch_all<-array(NA,dim =c(length(bandit_cutpoints)))
#point is the index of switching to arm A
for (i in 1:length(bandit_cutpoints)){
  zzz<-array(NA,dim =c(20))
  for (j in 1:20){
    
    check_index<-bandit_cutpoint[i,j,]
    check_index
    z1<-rle(check_index)
    switch_point<- array(NA,dim = length(z1$lengths))
    switch_length<- array(NA,dim = length(z1$lengths))
    for (k in 1:length(z1$lengths)){
      #if (z1$lengths[k]>1){
        if(z1$lengths[1] ==10 & z1$values[1] == -1)
          {
          switch_point[1]<-2
          switch_length[1]<- (z1$lengths[1])-1 
        }else if(sum((z1$values)) == 55)
          {
            switch_point[k]<-0
            switch_length[k]<- 0 
          }else if (z1$lengths[k]>1){
    switch_point[k]<-sum(z1$lengths[1:k-1])+2
    switch_length[k]<- z1$lengths[k]-1 
        }
    }
    switch_point<-switch_point[!is.na(switch_point)]
    if(is_empty(switch_point) | sum(switch_point)==0){
      switch_point<-0
      switch_length<-0
      switch_cut <- 0
      
    }else{
        switch_length<-switch_length[!is.na(switch_length)]
        switch_cut<- bandit_cutpoints[[i]][[j]][switch_point]
    }
    zzz[[j]][1]<-list(switch_point) # where switch to A
    zzz[[j]][2]<-list(switch_length) # length stay at A
    zzz[[j]][3]<-list(switch_cut)#cutpoints
  }
  bandit_switch_all[i]<-list(zzz) 
}



```



```{r}

#switching point in bandit to arm A
switch_final<- NA
visual_switch_all<-array(NA,dim =c(length(visual_cutpoints)))
#point is the index of switching to arm A
for (i in 1:length(visual_cutpoints)){
  zzz<-array(NA,dim =c(20))
  for (j in 1:20){
    
    check_index<-as.numeric(visual_cutpoints[[i]][[j]])
    if(!is.na(check_index)){
    
    z1<-rle(check_index)
    switch_point<- array(NA,dim = length(z1$lengths))
    switch_length<- array(NA,dim = length(z1$lengths))
    
    for (k in 1:length(z1$lengths)){
      #if (z1$lengths[k]>1){
        if(z1$lengths[1] ==length(z1$lengths) & z1$values[1] == -1)
          {
          switch_point[1]<-2
          switch_length[1]<- (z1$lengths[1])-1 
        }else if(sum((z1$values)) == sum(1:length(z1$lengths)))
          {
            switch_point[k]<-0
            switch_length[k]<- 0 
          }else if (z1$lengths[k]>1){
    switch_point[k]<-sum(z1$lengths[1:k-1])+2
    switch_length[k]<- z1$lengths[k]-1 
        }
    }
    switch_point<-switch_point[!is.na(switch_point)]
    if(is_empty(switch_point) | sum(switch_point)==0){
      switch_point<-0
      switch_length<-0
      switch_cut <- 0
      
    }else{
        switch_length<-switch_length[!is.na(switch_length)]
        switch_cut<- visual_cutpoints[[i]][[j]][switch_point]
    }
    zzz[[j]][1]<-list(switch_point) # where switch to A
    zzz[[j]][2]<-list(switch_length) # length stay at A
    zzz[[j]][3]<-list(switch_cut)#cutpoints
  }
}
  visual_switch_all[i]<-list(zzz) 
}



```



```{r}
#converting list to array
visual_best_cut<-array(NA,dim =c(length(visual_cutpoints),20))
visual_best_switch<-array(NA,dim =c(length(visual_cutpoints),20))
visual_best_stay<-array(NA,dim =c(length(visual_cutpoints),20))

bandit_best_cut<-array(NA,dim =c(length(visual_cutpoints),20))
bandit_best_switch<-array(NA,dim =c(length(visual_cutpoints),20))
bandit_best_stay<-array(NA,dim =c(length(visual_cutpoints),20))

for ( i in 1:length(visual_cutpoints)){
  for (j in 1:20){
    if (!is.na(visual_switch_all[[i]][[j]])){
      visual_best_cut[i,j]<-visual_switch_all[[i]][[j]][[3]][which.max(visual_switch_all[[i]][[j]][[2]])]
        visual_best_switch[i,j]<-visual_switch_all[[i]][[j]][[1]][which.max(visual_switch_all[[i]][[j]][[2]])]
        visual_best_stay[i,j]<-max(visual_switch_all[[i]][[j]][[2]])
    }
  }
}
for ( i in 1:length(bandit_cutpoints)){
  for (j in 1:20){
    if ( (!is.na(bandit_switch_all[[i]][[j]]))){
      
 
        bandit_best_cut[i,j]<-bandit_switch_all[[i]][[j]][[3]][which.max(bandit_switch_all[[i]][[j]][[2]])]
        bandit_best_switch[i,j]<-bandit_switch_all[[i]][[j]][[1]][which.max(bandit_switch_all[[i]][[j]][[2]])]
        bandit_best_stay[i,j]<-max(bandit_switch_all[[i]][[j]][[2]])

    }
  }
}

```

```{r}
library(readxl)
library(gdata)
library(lme4)
# load modified version of question data
 team_id_risk2<-data.frame('id'=team_id_risk$id,'group'=team_id_risk$group)
 new_test <- read_excel("/Users/au608780/Documents/new_test.xlsx")
 new_question<-data.frame('id'=new_test$id,'gender'=new_test$gender,'age'=new_test$age,'risk'=new_test$risk)
 dnew<-merge(team_id_risk2,new_question,by='id')
 bandit_expr_new_all<-(unmatrix(as.data.frame(t(bandit_expr_new)),byrow=T))
 bandit_cut_all<- scale(unmatrix(as.data.frame(t(bandit_best_cut)),byrow=T))
 bandit_stay_all<- scale(unmatrix(as.data.frame(t(bandit_best_stay)),byrow=T))
 bandit_switch_all<- scale(unmatrix(as.data.frame(t(bandit_best_switch)),byrow=T))
 bandit_mean_all<-scale(unmatrix(as.data.frame(t(mean_choice_bandit)),byrow=T))
  bandit_mode_all<-(unmatrix(as.data.frame(t(mode_choice_bandit)),byrow=T))
  bandit_cut_ns<- (unmatrix(as.data.frame(t(bandit_best_cut)),byrow=T))
 visual_cut_ns<- (unmatrix(as.data.frame(t(visual_best_cut)),byrow=T))
  visual_cut_all<- scale(unmatrix(as.data.frame(t(visual_best_cut)),byrow=T))
 visual_stay_all<- scale(unmatrix(as.data.frame(t(visual_best_stay)),byrow=T))
 visual_switch_all<- scale(unmatrix(as.data.frame(t(visual_best_switch)),byrow=T))
  visual_mean_all<-scale(unmatrix(as.data.frame(t(mean_look_visual)),byrow=T))
  visual_mode_all<-(unmatrix(as.data.frame(t(mode_option_looked)),byrow=T))
  visual_expr_new <- array(NA,dim = c(108,20))
  for (i in 1:108){
    visual_expr_new[i,]<-unlist(all_report[[i]][[7]])
  }
  visual_expr_new_all<-(unmatrix(as.data.frame(t(visual_expr_new)),byrow=T))
 
rep_gender<-rep(dnew$gender,each=20)
rep_id<-rep(dnew$id,each=20)
rep_group<-rep(dnew$group,each=20)
rep_risk<-rep(dnew$risk,each=20)
rep_age<-rep(dnew$age,each=20)
z_risk<-scale(as.numeric(dnew$risk))
rep_zrisk<-rep(z_risk,each=20)
rep_risk <- rep(dnew$risk,each=20)

data_all<-data.frame('id'=rep_id,'group'=rep_group,'period'=rep(1:20,108),'gender'=rep_gender,'zrisk'=rep_zrisk,'risk'=rep_risk,'bandit_mean_expr_rate'=bandit_mean_all,'bandit_mode_expr_rate'=bandit_mode_all,'bandit_cutpoint'=bandit_cut_all,'bandit_stay_length'=bandit_stay_all,'bandit_switch_indx'=bandit_switch_all,'visual_mean_expr_rate'=visual_mean_all,'visual_mode_expr_rate'=visual_mode_all,'visual_cutpoint'=visual_cut_all,'visual_stay_length'=visual_stay_all,'visual_switch_indx'=visual_switch_all,'visual_new_expr'=visual_expr_new_all,'bandit_new_expr'=bandit_expr_new_all,'bandit_cut_ns'=bandit_cut_ns,'visual_cut_ns'=visual_cut_ns)
data_all$gender[data_all$gender==2]<-0 #females
hist(data_all$visual_cutpoint)
hist(data_all$bandit_cutpoint)
model1<-lm(bandit_cutpoint~visual_cutpoint,data = data_all)
 summary(model1)
 coef(model1)
 (prelim_plot <- ggplot(data_all, aes(x = visual_cutpoint, y = bandit_cutpoint)) 
+     geom_point() +
     geom_smooth(method = "lm"))
 plot(model1, which = 1)
 plot(model1, which = 2)
 (split_plot <- ggplot(aes(visual_cutpoint, bandit_cutpoint), data = data_all) + 
     geom_point() + 
     facet_wrap(~ risk) + 
     xlab("visual") + 
    ylab("bandit"))
 # how cutpoints in visual related to cutpoints in bandit -> dependent variable is bandit, visual cutpoint is the fixed effect
 #we want to control effect of risk and gender and variation between people
 #random effect should have at least five levels. So, we would fit less than this level factor (a two level factor: male or female) as a fixed, not random, effect.
 model1<-lmer(scale(bandit_new_expr)~scale(visual_new_expr)+(1|id),data = data_all)
 tab_model(model1)
 
model2<-lmer(bandit_cutpoint~visual_cutpoint+(1|id),data = data_all,REML = FALSE)
 summary(model2)
 #treats the two random effects as if they are crossed
 model3<-lmer(bandit_cutpoint~visual_cutpoint+(1|risk)+(1|id),data = data_all,REML = FALSE)
 summary(model3)
 model4<-lmer(bandit_cutpoint~visual_cutpoint+(1|risk)+(1|id)+gender,data = data_all,REML = FALSE)
 summary(model4)
 #adding random slopes
  model5<-lmer(bandit_cutpoint~visual_cutpoint+(1+visual_cutpoint|id/risk)+gender,data = data_all,REML = FALSE)
   model6<-lmer(bandit_cutpoint~visual_cutpoint+(1+visual_cutpoint|id)+gender,data = data_all,REML = FALSE)
 summary(model6)
 model7<-lmer(bandit_cutpoint~visual_cutpoint+(1+visual_cutpoint|id/gender),data = data_all,REML = FALSE)
 model8<-lmer(bandit_cutpoint~visual_cutpoint+(1|id)+gender,data = data_all,REML = FALSE)
 anova(model6,model8)
 #thus random slope does not make any differences here
  model9<-lmer(bandit_cutpoint~visual_cutpoint+(1|id),data = data_all,REML = FALSE)
  #thus gender does not make any difference and model 9 fits best
  model10<-lmer((bandit_cutpoint)~(visual_cutpoint)+(1|id)+(1|risk)+(1|gender),data = data_all)
  model11<-lmer((bandit_cutpoint)~(visual_cutpoint)+(1|id),data = data_all)
 stargazer(model10, type = "text",
          digits = 3,
          star.cutoffs = c(0.05, 0.01, 0.001),
          digit.separator = "")
 # use REML estimators for comparison of models with different random effects
 #change random effect to make sure the one to choose
 
 #model selection process (top-down)
 #fit a full model
 #sort out the random effects structure
 #sort out fixed effects structure 
 
 #The	 way	 to	 read	 the	 output	 for	 age	 (“-0.9099“)	 is	 that	 for	 every	increase	of	age	by	1	you	decrease	voice	pitch	by	0.9099	Hertz.	E
 #See	that	the	line	at	x=0	is	267.0765
#(our	intercept),	and	the	slope	is -0.9099.
 model3<-lm(bandit~visual + gender , data = data_all)
 summary(model3)
 model4<-lm(bandit~visual + risk , data = data_all)
summary(model4)
model4<-lm(bandit~visual + risk * gender , data = data_all)
summary(model4)
 model6<-  aov(bandit~visual,data = data_all)
 summary(model6)
 model7<-lm(bandit~visual + id , data = data_all)
summary(model7)
#mixed models
mixed1=lmer(bandit~visual + risk +(1|id)+gender, data = data_all)
summary(mixed1)
mixed1=lmer(cutbandit~(1+cutvisual|id) + (risk)*(gender) , data = data_all, REML=FALSE)
m1=lmer(cutbandit~(cutvisual+gender+ (1|risk)) , data = data_all, REML=FALSE) 
 reg_model1<-array(NA, dim =length(visual_cutpoints) )
  reg_model2<-array(NA, dim =length(visual_cutpoints) )
  z_each_risk<-array(NA, dim =20 )
for ( i in 1:length(visual_cutpoints)){
 z_each_risk<- rep(z_risk[i],each=20)
reg_model1[i]<-list(lm(z_cut_bandit[i,]~z_cut_visual[i,]))
reg_model2[i]<-list(lm(z_cut_bandit[i,]~z_cut_visual[i,]+ (z_each_risk)))
}
```


```{r}
library("ggpubr")
p<-ggscatter(data_all, x = "bandit_cutpoint", y = "visual_cutpoint", 
             add = "reg.line", conf.int = TRUE, 
             cor.coef = TRUE, cor.method = "pearson",
             xlab = "Bandit cut_points", ylab = "Visual cut_points",size = 1,  shape = 21) 
p+
    font("xlab", size = 10)+
    font("ylab", size = 10)+
    font("xy.text", size = 10)
```

```{r}
#Alex last comment
alex1<-lm(scale(bandit_cut_ns)~(gender)+scale(risk)+id,data = data_all)
 da<-coef(summary(alex1))
 da2<-da[4:107,1]
 bandit_cut_rem<-da2
alex1<-lm(scale(visual_cut_ns)~(gender)+scale(risk)+id,data = data_all)
 da<-coef(summary(alex1))
 da2<-da[4:107,1]
 visual_cut_rem<-da2
 plot(visual_cut_rem,bandit_cut_rem)
 m1<-lm(bandit_cut_rem~visual_cut_rem)
 tab_model(m1)
 ###
 alex1<-lm(scale(bandit_new_expr)~(gender)+scale(risk)+id,data = data_all)
 da<-coef(summary(alex1))
 da2<-da[4:107,1]
 bandit_expr_rem<-da2
alex1<-lm(scale(visual_new_expr)~(gender)+scale(risk)+id,data = data_all)
 da<-coef(summary(alex1))
 da2<-da[4:107,1]
 visual_expr_rem<-da2
 plot(visual_cut_rem,bandit_cut_rem)
 plot(visual_expr_rem,bandit_expr_rem)
 m2<-lm(bandit_expr_rem~visual_expr_rem)
 tab_model(m2)
 
 rem_data<-data.frame('bandit_exploration'=bandit_expr_rem,'visual_exploration'=visual_expr_rem,'bandit_cutpoint'=bandit_cut_rem,'visual_cutpoint'=visual_cut_rem)
 library("ggpubr")
 library(gridExtra)

 
 p1<-ggscatter(rem_data, x = "bandit_exploration", y = "visual_exploration", 
             add = "reg.line", conf.int = TRUE, 
           
             xlab = "Bandit exploration", ylab = "Visual exploration",size = 1,  shape = 21) 
p1+
    font("xlab", size = 10)+
    font("ylab", size = 10)+
    font("xy.text", size = 10)
 
p2<-ggscatter(rem_data, x = "bandit_cutpoint", y = "visual_cutpoint", 
             add = "reg.line", conf.int = TRUE, 
             
             xlab = "Bandit cut_points", ylab = "Visual cut_points",size = 1,  shape = 21) 
p2+
    font("xlab", size = 10)+
    font("ylab", size = 10)+
    font("xy.text", size = 10)
grid.arrange(p1, p2, ncol=2)
```

